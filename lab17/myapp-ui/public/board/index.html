<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .loading {
            text-align: center;
            font-size: 1.1em;
            color: #666;
            margin: 20px 0;
        }
        
        .error {
            color: red;
            font-size: 0.9em;
            text-align: center;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
        }
 
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // 날짜 포맷팅 함수
        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toISOString().split('T')[0];
        };

        // BoardList 컴포넌트
        const BoardList = () => {
            const [boards, setBoards] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            // useCallback으로 함수 메모이제이션 - 의존성이 변하지 않으면 같은 함수 참조 유지
            const loadBoards = useCallback(async () => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    const response = await axios.get('http://localhost:9999/boards');
                    const jsonResult = response.data;
                    
                    if (jsonResult.status !== 'success') {
                        throw new Error('요청 처리 오류');
                    }

                    setBoards(jsonResult.content);
                } catch (err) {
                    console.error('게시글 로드 오류:', err);
                    setError('게시글을 불러올 수 없습니다.');
                } finally {
                    setLoading(false);
                }
            }, []); // 빈 의존성 배열 - 컴포넌트 생명주기 동안 함수가 변하지 않음

            // 컴포넌트 마운트 시 게시글 로드
            useEffect(() => {
                loadBoards();
            }, []);

            return (
                <div className="container">
                    <h1>게시글 목록</h1>
                    
                    {loading && (
                        <div className="loading">
                            게시글을 불러오는 중...
                        </div>
                    )}
                    
                    {error && (
                        <div className="error">
                            {error}
                        </div>
                    )}
                    
                    {!loading && !error && (
                        <table>
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th>제목</th>
                                    <th>작성일</th>
                                    <th>조회수</th>
                                </tr>
                            </thead>
                            <tbody>
                                {boards.length === 0 ? (
                                    <tr>
                                        <td colSpan="4" className="no-data">
                                            게시글이 없습니다.
                                        </td>
                                    </tr>
                                ) : (
                                    boards.map(board => (
                                        <tr key={board.no}>
                                            <td>{board.no}</td>
                                            <td>
                                                <a href={`/board/view.html?no=${board.no}`}>
                                                    {board.title}
                                                </a>
                                            </td>
                                            <td>{formatDate(board.createdDate)}</td>
                                            <td>{board.viewCount}</td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    )}
                    
                    <div>
                        [<a href="/board/form.html">새 게시글</a>]
                        [<a href="/">홈으로</a>]
                    </div>
                </div>
            );
        };

        // App 컴포넌트 렌더링
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<BoardList />);

    </script>
</body>
</html>
